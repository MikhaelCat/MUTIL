{% extends 'base.html' %}
{% block content %}
<div class="hero-section">
    <div class="hero-content">
        <h1 class="hero-title">MUTIL</h1>
        <p class="hero-subtitle">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ë–µ–∑—É–º–Ω—ã—Ö –ó–∞–¥–∞–Ω–∏–π</p>
        <p class="hero-description">
            –ü–æ–ª—É—á–∏ —Å–ª—É—á–∞–π–Ω–æ–µ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –∏ –ø–æ–¥–µ–ª–∏—Å—å —Å–≤–æ–∏–º –±–µ–∑—É–º–Ω—ã–º –æ—Ç–≤–µ—Ç–æ–º —Å –º–∏—Ä–æ–º!
        </p>
    </div>
</div>

<div class="main-container">
    <div class="task-section">
        <div class="card task-card">
            <h2>üéØ –¢–≤–æ—ë –ó–∞–¥–∞–Ω–∏–µ</h2>
            <div id="task-display" class="task-display">
                <p class="task-placeholder">–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ!</p>
            </div>
            <button id="get-task-btn" class="btn btn-primary">
                <span class="btn-icon">üé≤</span>
                –ü–æ–ª—É—á–∏—Ç—å –ó–∞–¥–∞–Ω–∏–µ
            </button>
            <div class="loading" id="loading" style="display: none;">
                <div class="spinner"></div>
                <p>–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –±–µ–∑—É–º–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ...</p>
            </div>
        </div>
    </div>

    <div class="submit-section" id="submit-section" style="display: none;">
        <div class="card submit-card">
            <h2>üìù –ü–æ–¥–µ–ª–∏—Å—å –°–≤–æ–∏–º –û—Ç–≤–µ—Ç–æ–º</h2>
            <form id="submit-form" action="/api/submit" method="POST" enctype="multipart/form-data">
                <input type="hidden" id="task-id" name="task_id">
                
                <div class="form-group">
                    <label for="author_info">–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç? (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="text" id="author_info" name="author_info" placeholder="–ê–Ω–æ–Ω–∏–º" class="form-input">
                </div>
                
                <div class="form-group">
                    <label for="content">–¢–≤–æ–π –æ—Ç–≤–µ—Ç –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ:</label>
                    <textarea id="content" name="content" rows="4" placeholder="–ü–æ–¥–µ–ª–∏—Å—å —Å–≤–æ–∏–º –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º..." class="form-textarea" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="file">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                    <input type="file" id="file" name="file" accept="image/*" class="form-file">
                    <small class="form-hint">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB</small>
                </div>
                
                <button type="submit" class="btn btn-success">
                    <span class="btn-icon">üöÄ</span>
                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –ì–∞–ª–µ—Ä–µ—é
                </button>
            </form>
        </div>
    </div>

    <div class="stats-section">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="total-tasks">0</div>
                <div class="stat-label">–ó–∞–¥–∞–Ω–∏–π —Å–æ–∑–¥–∞–Ω–æ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-submissions">0</div>
                <div class="stat-label">–û—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—É—á–µ–Ω–æ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-votes">0</div>
                <div class="stat-label">–ì–æ–ª–æ—Å–æ–≤ –æ—Ç–¥–∞–Ω–æ</div>
            </div>
        </div>
    </div>
</div>

<div class="features-section">
    <div class="features-grid">
        <div class="feature-card">
            <div class="feature-icon">üé≠</div>
            <h3>–ë–µ–∑—É–º–Ω—ã–µ –ó–∞–¥–∞–Ω–∏—è</h3>
            <p>–ü–æ–ª—É—á–∞–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ –≤—ã–∑–æ–≤—ã, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ò–ò</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">üñºÔ∏è</div>
            <h3>–ì–∞–ª–µ—Ä–µ—è –û—Ç–≤–µ—Ç–æ–≤</h3>
            <p>–°–º–æ—Ç—Ä–∏, –∫–∞–∫ –¥—Ä—É–≥–∏–µ —Ä–µ—à–∞—é—Ç –±–µ–∑—É–º–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">‚ù§Ô∏è</div>
            <h3>–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</h3>
            <p>–ì–æ–ª–æ—Å—É–π –∑–∞ —Å–∞–º—ã–µ –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ –∏ —Å–º–µ—à–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">ü§ñ</div>
            <h3>Telegram –ë–æ—Ç</h3>
            <p>–ü–æ–ª—É—á–∞–π –∑–∞–¥–∞–Ω–∏—è –ø—Ä—è–º–æ –≤ Telegram</p>
        </div>
    </div>
</div>

<script>
let currentTaskId = null;

document.getElementById('get-task-btn').addEventListener('click', async function() {
    const button = this;
    const loading = document.getElementById('loading');
    const taskDisplay = document.getElementById('task-display');
    const submitSection = document.getElementById('submit-section');
    
    button.style.display = 'none';
    loading.style.display = 'block';
    
    try {
        const response = await fetch('/api/get-task');
        const data = await response.json();
        
        if (data.id && data.text) {
            currentTaskId = data.id;
            document.getElementById('task-id').value = data.id;
            
            taskDisplay.innerHTML = `
                <div class="task-text">
                    <span class="task-emoji">üéØ</span>
                    <p>"${data.text}"</p>
                </div>
            `;
            
            submitSection.style.display = 'block';
            
            submitSection.scrollIntoView({ behavior: 'smooth' });
        } else {
            throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è:', error);
        taskDisplay.innerHTML = `
            <div class="error-message">
                <span class="error-emoji">üòï</span>
                <p>–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑!</p>
            </div>
        `;
        button.style.display = 'inline-flex';
    } finally {
        loading.style.display = 'none';
    }
});

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
async function loadStats() {
    try {
        const response = await fetch('/api/stats');
        const stats = await response.json();
        
        document.getElementById('total-tasks').textContent = stats.total_tasks || 0;
        document.getElementById('total-submissions').textContent = stats.total_submissions || 0;
        document.getElementById('total-votes').textContent = stats.total_votes || 0;
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
    }
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', loadStats);
</script>
{% endblock %}